<!DOCTYPE html>
<html dir="rtl" lang="fa" data-theme="game">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0a1628">
  <title>ุดูู ุขููุงู</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- ===== LOBBY ===== -->
  <div id="lobby" class="h-full flex items-center justify-center p-4">
    <div class="w-full max-w-sm">
      <!-- Logo -->
      <div class="flex items-center justify-center gap-2 mb-8">
        <span class="text-2xl text-error animate-pulse-slow">โฅ</span>
        <span class="text-2xl text-white animate-pulse-slow" style="animation-delay:0.5s">โ</span>
        <h1 class="text-2xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent">
          ุดูู ุขููุงู
        </h1>
        <span class="text-2xl text-error animate-pulse-slow" style="animation-delay:1s">โฆ</span>
        <span class="text-2xl text-white animate-pulse-slow" style="animation-delay:1.5s">โฃ</span>
      </div>

      <!-- Welcome Screen -->
      <div id="welcomeScreen" class="text-center space-y-3">
        <h2 class="text-xl mb-6">ุฎูุด ุขูุฏุฏ!</h2>
        <button class="btn btn-primary btn-block gap-2" onclick="showCreateForm()">
          ๐ฎ ุณุงุฎุช ุจุงุฒ ุฌุฏุฏ
        </button>
        <button class="btn btn-ghost btn-block gap-2" onclick="showJoinForm()">
          ๐ช ูุฑูุฏ ุจู ุจุงุฒ
        </button>
      </div>

      <!-- Create Form -->
      <div id="createForm" class="card bg-base-300 p-6 hidden">
        <h3 class="text-lg font-bold text-center mb-4">๐ฎ ุณุงุฎุช ุจุงุฒ ุฌุฏุฏ</h3>
        <div class="space-y-3">
          <input type="text" id="createName" placeholder="ูุงู ุดูุง" maxlength="12"
                 class="input input-bordered w-full bg-base-100">
          <input type="text" id="createCode" placeholder="ฺฉุฏ ุงุชุงู" maxlength="10"
                 class="input input-bordered w-full bg-base-100">
          <input type="password" id="createPassword" placeholder="ุฑูุฒ ุนุจูุฑ (ุงุฎุชุงุฑ)"
                 class="input input-bordered w-full bg-base-100">
          <div class="flex items-center gap-3">
            <label class="text-sm opacity-70">ุณูู ุงูุชุงุฒ:</label>
            <select id="createScoreLimit" class="select select-bordered select-sm bg-base-100">
              <option value="300">ณฐฐ</option>
              <option value="500" selected>ตฐฐ</option>
              <option value="750">ทตฐ</option>
              <option value="1000">ฑฐฐฐ</option>
            </select>
          </div>
          <button class="btn btn-primary btn-block" onclick="createRoom()">โ ุณุงุฎุช ุงุชุงู</button>
          <button class="btn btn-ghost btn-sm btn-block" onclick="backToWelcome()">โ ุจุงุฒฺฏุดุช</button>
        </div>
      </div>

      <!-- Join Form -->
      <div id="joinForm" class="card bg-base-300 p-6 hidden">
        <h3 class="text-lg font-bold text-center mb-4">๐ช ูุฑูุฏ ุจู ุจุงุฒ</h3>
        <div class="space-y-3">
          <input type="text" id="joinName" placeholder="ูุงู ุดูุง" maxlength="12"
                 class="input input-bordered w-full bg-base-100">
          <input type="text" id="joinCode" placeholder="ฺฉุฏ ุงุชุงู" maxlength="10"
                 class="input input-bordered w-full bg-base-100">
          <input type="password" id="joinPassword" placeholder="ุฑูุฒ ุนุจูุฑ"
                 class="input input-bordered w-full bg-base-100">
          <button class="btn btn-primary btn-block" onclick="joinRoom()">โ ูุฑูุฏ</button>
          <button class="btn btn-ghost btn-sm btn-block" onclick="backToWelcome()">โ ุจุงุฒฺฏุดุช</button>
        </div>
      </div>

      <!-- Waiting Room -->
      <div id="waitingRoom" class="card bg-base-300 p-6 hidden">
        <h3 class="text-lg font-bold text-center mb-2">๐ด ุงุชุงู ุงูุชุธุงุฑ</h3>
        <div id="scoreLimitDisplay" class="text-center text-sm opacity-70 mb-4"></div>
        <div id="playersList" class="grid grid-cols-2 gap-2 mb-4"></div>
        <div class="text-center text-xs opacity-60 mb-4 space-y-1">
          <span class="text-team1">ุชู ฑ: ุจุงุฒฺฉู ฑ ู ณ</span>
          <span class="text-team2 block">ุชู ฒ: ุจุงุฒฺฉู ฒ ู ด</span>
        </div>
        <button id="readyBtn" class="btn btn-success btn-block" onclick="setReady()">
          โ ุขูุงุฏูโุงู!
        </button>
      </div>
    </div>
  </div>

  <!-- ===== GAME ===== -->
  <div id="game" class="h-full flex-col relative overflow-hidden hidden">
    <!-- Proposal Overlay -->
    <div id="proposalOverlay" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden">
      <div id="waitingMessage" class="card bg-base-300 p-6 animate-pulse"></div>
    </div>

    <!-- Top Bar -->
    <div id="topBar" class="flex justify-between items-center px-4 py-2 bg-black/30 z-50">
      <div class="text-center">
        <div class="text-xs opacity-60">ุชู ฑ</div>
        <div id="score0" class="text-xl font-bold text-team1">0</div>
      </div>
      <div class="text-center text-sm">
        <div id="scoreLimitGame" class="text-xs opacity-50"></div>
        <div id="contractDisplay"></div>
        <div id="trumpDisplay"></div>
      </div>
      <div class="text-center">
        <div class="text-xs opacity-60">ุชู ฒ</div>
        <div id="score1" class="text-xl font-bold text-team2">0</div>
      </div>
    </div>

    <!-- Voice Controls -->
    <div id="voiceControls" class="absolute top-14 left-2 z-50">
      <button id="btnMic" class="btn btn-sm btn-neutral gap-1" onclick="toggleMic()">
        <span class="icon">๐ค</span>
        <span class="status text-xs">ุฑูุดู</span>
      </button>
      <div id="voiceStatus" class="text-xs text-center mt-1 opacity-60"></div>
    </div>

    <!-- Opponents -->
    <div id="playerTop" class="opponent absolute top-14 left-1/2 -translate-x-1/2 flex flex-col items-center z-20">
      <div class="opponent-info flex flex-col items-center px-2 py-1 bg-black/50 rounded text-xs">
        <span class="opponent-name"></span>
        <span class="card-count opacity-60"></span>
      </div>
      <div class="opponent-cards flex mt-1"></div>
    </div>

    <div id="playerLeft" class="opponent absolute left-2 top-1/2 -translate-y-1/2 flex flex-row-reverse items-center z-20">
      <div class="opponent-info flex flex-col items-center px-2 py-1 bg-black/50 rounded text-xs mr-1">
        <span class="opponent-name"></span>
        <span class="card-count opacity-60"></span>
      </div>
      <div class="opponent-cards flex flex-col"></div>
    </div>

    <div id="playerRight" class="opponent absolute right-2 top-1/2 -translate-y-1/2 flex flex-row items-center z-20">
      <div class="opponent-info flex flex-col items-center px-2 py-1 bg-black/50 rounded text-xs ml-1">
        <span class="opponent-name"></span>
        <span class="card-count opacity-60"></span>
      </div>
      <div class="opponent-cards flex flex-col"></div>
    </div>

    <!-- Table Center -->
    <div id="tableCenter" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 
                                  w-[85%] max-w-[400px] h-[60vh] min-h-[200px] max-h-[350px]
                                  flex items-center justify-center">
      <div id="dropZone" class="relative w-[90%] h-[85%] min-h-[180px] max-h-[300px]
                                 border-2 border-dashed border-white/10 rounded-2xl
                                 flex items-center justify-center transition-all">
        <div id="playedCards" class="relative w-[120px] h-[100px]"></div>
        <div id="dropHint" class="absolute text-sm opacity-50 hidden">๐ด ฺฉุงุฑุช ุฑุง ุงูุฌุง ุฑูุง ฺฉูุฏ</div>
      </div>
    </div>

    <!-- Game Log -->
    <div id="gameLog" class="absolute bottom-40 right-2 w-[140px] max-h-[100px] overflow-hidden z-40"></div>

    <!-- My Hand Area -->
    <div id="myHandArea" class="absolute bottom-0 left-0 right-0 p-2 
                                 bg-gradient-to-t from-black/60 to-transparent z-30">
      <div id="myInfo" class="flex items-center justify-center gap-2 mb-1">
        <span id="myName" class="font-bold text-primary"></span>
        <span id="turnIndicator" class="text-accent text-sm"></span>
        <span id="turnTimer" class="turn-timer hidden"></span>
      </div>
      <div id="myHand" class="fan-hand"></div>
    </div>

    <!-- Controls -->
    <div id="controls" class="absolute bottom-44 left-1/2 -translate-x-1/2 flex gap-2 z-50"></div>

    <!-- Proposal Panel -->
    <div id="proposalPanel" class="fixed bottom-40 left-1/2 -translate-x-1/2 
                                    bg-base-200 p-4 rounded-2xl shadow-xl z-50 w-[90%] max-w-xs hidden">
      <div class="text-center mb-2">
        <h3 class="font-bold">๐ข ุงูุชุฎุงุจ ูุฑุงุฑุฏุงุฏ</h3>
        <div id="proposalLogMini" class="max-h-14 overflow-y-auto text-xs mt-1"></div>
      </div>
      <div id="proposalGrid" class="grid grid-cols-5 gap-1 mb-2"></div>
      <button class="btn btn-error btn-block" onclick="passProposal()">โ ูพุงุณ</button>
    </div>
  </div>

  <!-- ===== MODALS ===== -->
  
  <!-- Mode Selection Modal -->
  <dialog id="modeModal" class="modal">
    <div class="modal-box bg-base-200">
      <h3 class="font-bold text-lg text-center mb-4">๐ฏ ุงูุชุฎุงุจ ููุน ุจุงุฒ</h3>
      <div class="grid grid-cols-2 gap-3 mb-4">
        <label class="cursor-pointer">
          <input type="radio" name="gameMode" value="hokm" class="hidden peer">
          <div class="card bg-base-300 p-4 text-center border-2 border-transparent 
                      peer-checked:border-primary peer-checked:bg-primary/10 transition-all">
            <div class="text-lg font-bold">๐ ุญฺฉู</div>
            <div class="text-xs opacity-60">ุขุณ ููโุชุฑู</div>
          </div>
        </label>
        <label class="cursor-pointer">
          <input type="radio" name="gameMode" value="nars" class="hidden peer">
          <div class="card bg-base-300 p-4 text-center border-2 border-transparent 
                      peer-checked:border-primary peer-checked:bg-primary/10 transition-all">
            <div class="text-lg font-bold">โฌ๏ธ ููุฑุณ</div>
            <div class="text-xs opacity-60">ุฏููู ููโุชุฑู</div>
          </div>
        </label>
        <label class="cursor-pointer">
          <input type="radio" name="gameMode" value="asNars" class="hidden peer">
          <div class="card bg-base-300 p-4 text-center border-2 border-transparent 
                      peer-checked:border-primary peer-checked:bg-primary/10 transition-all">
            <div class="text-lg font-bold">๐ฐ๏ธ ุขุณโููุฑุณ</div>
            <div class="text-xs opacity-60">ุขุณ ููุ ุดุงู ุถุนู</div>
          </div>
        </label>
        <label class="cursor-pointer">
          <input type="radio" name="gameMode" value="sars" class="hidden peer">
          <div class="card bg-base-300 p-4 text-center border-2 border-transparent 
                      peer-checked:border-primary peer-checked:bg-primary/10 transition-all">
            <div class="text-lg font-bold">๐ซ ุณูุฑุณ</div>
            <div class="text-xs opacity-60">ุจุฏูู ุญฺฉู</div>
          </div>
        </label>
      </div>
      
      <div id="suitSelector" class="text-center mb-4 hidden">
        <p class="text-sm opacity-70 mb-2">ุฎุงู ุญฺฉู:</p>
        <div class="flex justify-center gap-2">
          <button class="btn btn-square btn-lg text-2xl suit-btn" data-suit="โ" onclick="selectSuit('โ')">โ</button>
          <button class="btn btn-square btn-lg text-2xl text-card-red suit-btn" data-suit="โฅ" onclick="selectSuit('โฅ')">โฅ</button>
          <button class="btn btn-square btn-lg text-2xl text-card-red suit-btn" data-suit="โฆ" onclick="selectSuit('โฆ')">โฆ</button>
          <button class="btn btn-square btn-lg text-2xl suit-btn" data-suit="โฃ" onclick="selectSuit('โฃ')">โฃ</button>
        </div>
      </div>
      
      <button id="confirmModeBtn" class="btn btn-primary btn-block" onclick="confirmMode()" disabled>
        ุงูุชุฎุงุจ ฺฉูุฏ
      </button>
    </div>
  </dialog>

  <!-- Result Modal -->
  <dialog id="resultModal" class="modal">
    <div class="modal-box bg-base-200 text-center">
      <h3 id="resultTitle" class="font-bold text-lg"></h3>
      <div id="resultCards" class="flex justify-center gap-2 my-4"></div>
      <div id="resultPoints" class="text-lg"></div>
    </div>
  </dialog>

  <!-- Match End Modal -->
  <dialog id="endModal" class="modal">
    <div class="modal-box bg-base-200 text-center">
      <h2 id="endTitle" class="text-2xl font-bold mb-4"></h2>
      <div id="endDetails" class="mb-4"></div>
      <button class="btn btn-primary" onclick="playAgain()">๐ ุงุฏุงูู ุจุงุฒ</button>
    </div>
  </dialog>

  <!-- Game Over Modal -->
  <dialog id="gameOverModal" class="modal">
    <div class="modal-box bg-base-200 text-center max-w-sm">
      <h2 id="gameOverTitle" class="text-2xl font-bold mb-4"></h2>
      <div id="gameOverDetails" class="mb-4"></div>
      <div id="gameHistory" class="mb-4 text-sm"></div>
      <button id="resetGameBtn" class="btn btn-primary btn-block" onclick="resetGame()">
        ๐ ุดุฑูุน ุจุงุฒ ุฌุฏุฏ
      </button>
    </div>
  </dialog>

  <!-- Audio Container -->
  <div id="audioContainer" class="hidden"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="js/voice.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/app.js"></script>
</body>
</html>